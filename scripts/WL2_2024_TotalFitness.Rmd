---
title: "WL2_2024_TotalFitness"
author: "Brandie QC"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Calculating total fitness for plants planted in 2024
Takes into account 2024 and 2025 data 

Question: Is assisted gene flow better than assisted migration?
-   If so, would expect F1s (half high, half low elev) to perform better than parents 
-   If not, parents would do better than F1s 
-   Also, based on 2023 results would expect High x High F1s to be the worst (esp through first year of life)

## Libraries
```{r}
library(tidyverse)

sem <- function(x, na.rm=FALSE) {  #for calculating standard error
  sd(x,na.rm=na.rm)/sqrt(length(na.omit(x)))
} 
```

## Read in data
```{r}
wintsurv <- read_csv("../input/WL2_2025_Data/CorrectedCSVs/WL2_overwinter_survival_20250523_corrected.csv") #contains all year 1 info too
surv_2025 <- read_csv("../input/WL2_2025_Data/CorrectedCSVs/WL2_mort_pheno_20250929_corrected.csv") %>%  #for surv to budding 
  select(bed:bud.date, death.date)
fruits_2025 <- read_csv("../input/WL2_2025_Data/CorrectedCSVs/WL2_ann_cens_20251006_corrected.csv") %>% #for fruit #
  select(bed:Unique.ID, num.fruit)
```

## Pop Info
```{r}
pop_info_2024 <- read_csv("../input/WL2_2024_Data/Final_2023_2024_Pop_Loc_Info.csv") %>% 
  select(Pop.Type:unique.ID) %>% 
  rename(row=bedrow, col=bedcol)

pop_info_2025 <- read_csv("../input/WL2_2025_Data/2025_Pop_Loc_Info Updated.csv") %>% 
  select(status:Unique.ID)
```

## Elevation Info / Climate distance
```{r}
clim_dist_2024 <- read_csv("../output/Climate/WL2_2024_Clim_Dist.csv") %>% select(-conf.low, -conf.high)
head(clim_dist_2024)

clim_dist_2024_wide <- clim_dist_2024 %>% 
  pivot_wider(names_from = timeframe, values_from = Gowers_Dist, names_prefix = "GD_") %>% 
  rename(pop=parent.pop)
```

## Calculate y1 fitness and remove plants not planted in 2024
```{r}
wintsurv %>%  
  left_join(pop_info_2024) %>% 
  filter(Pop.Type=="Parent" | Pop.Type=="F1") %>% filter(!is.na(bud.date)) #none of the 2024 plants reproduced (don't need to take into account any annual plants)

y1_fitness <- wintsurv %>% select(bed:unique.ID, bud.date, death.date, missing.date, survey.notes) %>% 
  left_join(pop_info_2024) %>% 
  filter(unique.ID != "buffer") %>% #remove buffers
  filter(Pop.Type=="Parent" | Pop.Type=="F1") %>%  #keep only plants planted in 2024
  select(loc, bed:unique.ID, Pop.Type, pop:rep, death.date:survey.notes) %>% 
  mutate(deadatplanting = if_else(is.na(survey.notes), NA,
                                  if_else(survey.notes=="Dead at planting", "Yes", NA))) %>% 
  filter(is.na(deadatplanting)) %>% #remove plants that were dead at planting 
  filter(is.na(missing.date)) %>% #remove plants that went missing 
  select(-deadatplanting, -missing.date, -survey.notes) %>% #remove unnecessary rows 
  mutate(death.date=mdy(death.date)) %>% #convert to date format 
  mutate(Establishment = if_else(is.na(death.date), 1, 
                                 if_else(death.date < "2024-07-06", 0, 1)), #establishment = first 3 weeks post-transplant 
         Y1Surv = if_else(Establishment==0, NA, #can't survive year 1 if you didn't establish 
                          if_else(is.na(death.date), 1, 
                                        if_else(death.date < "2024-11-01", 0, 1))), #year 1 ended in Oct
         WintSurv = if_else(Establishment==0 | Y1Surv==0, NA, #can only have wint surv if survived y1 
                            if_else(is.na(death.date), 1, 0))) 
y1_fitness %>% filter(WintSurv==1) #33 plants survived the winter 
```

## Calculate y2 fitness and remove plants not planted in 2024
```{r}
surv_2025 %>% left_join(pop_info_2025) %>% filter(status=="2024-survivor") %>% filter(is.na(death.date)) %>% filter(is.na(bud.date)) #0 2024 plants alive at end of 2025 that did not reproduce

y2_fitness <- pop_info_2025 %>% 
  left_join(surv_2025) %>% 
  left_join(fruits_2025) %>% 
  filter(Unique.ID!="buffer", !is.na(Unique.ID)) %>% 
  filter(status=="2024-survivor") %>% 
  mutate(Pop.Type=if_else(str_detect(pop.id, "\\) x"), "F2",
                          if_else(str_detect(pop.id, "x"), "F1",
                                  "Parent"
                          ))) %>% 
  filter(Pop.Type!="F2") %>% #remove F2s
  mutate(SurvtoBud=if_else(!is.na(bud.date), 1, 0)) %>% 
  select(unique.ID=Unique.ID, Pop.Type, pop=pop.id, mf, rep, SurvtoBud, num.fruit)
y2_fitness %>% filter(SurvtoBud==1, is.na(num.fruit)) #2 plants that survived to rep with no fruit number 

#checked fruiting of plants planted in 2025
fruits_2025 %>% left_join(pop_info_2025) %>% 
  filter(Unique.ID!="buffer", !is.na(Unique.ID)) %>% 
  filter(status=="available") %>% 
  filter(!is.na(num.fruit)) #no F1s fruited, only TM2 fruited 
```

## Merge y1 and y2 fitness ---> total fitnes
```{r}
total_fit_2024plants <- y1_fitness %>% 
  select(-death.date) %>% 
  mutate(mf=as.character(mf)) %>% #needed for the merge
  left_join(y2_fitness) %>% 
  select(-mf) %>% #remove because all NAs
  mutate(ProbFruit=if_else(is.na(num.fruit) | num.fruit==0, 0, 1),
         TotalFitness=if_else(ProbFruit==0, 0, num.fruit)) %>% 
  separate(pop, c("dame_pop",NA, "sire_pop"), remove = FALSE) %>% #define pops for crosses
  mutate(sire_pop=if_else(Pop.Type=="Parent", dame_pop, sire_pop)) %>% 
  #add clim and elev info for dames and sires:
  left_join(clim_dist_2024_wide, by=join_by(dame_pop==pop)) %>% 
  select(-elevation.group, -Season, -Year) %>% 
  rename(dame_elev=elev_m, dame_Lat=Lat, dame_Long=Long, dame_GD_Recent=GD_Recent, dame_GD_Historic=GD_Historic) %>% 
  left_join(clim_dist_2024_wide, by=join_by(sire_pop==pop)) %>% 
  select(-elevation.group, -Season, -Year) %>% 
  rename(sire_elev=elev_m, sire_Lat=Lat, sire_Long=Long, sire_GD_Recent=GD_Recent, sire_GD_Historic=GD_Historic) %>% 
  mutate(meanElev=(dame_elev+sire_elev)/2, 
         mean_GD_Recent=(dame_GD_Recent+sire_GD_Recent)/2, 
         mean_GD_Historic=(dame_GD_Historic+sire_GD_Historic)/2) #means for parents are just the parent's actual value since I set that pop as dame and sire 
#total_fit_2024plants %>% filter(WintSurv==1, is.na(SurvtoBud)) #double check that the merge worked
head(total_fit_2024plants)
```

## Box Plots
```{r}
total_fit_2024plants %>% 
  ggplot(aes(x=pop, y=TotalFitness, colour = Pop.Type)) + #0s included 
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

total_fit_2024plants %>%
  mutate(num.fruit=if_else(is.na(num.fruit) | num.fruit==0, NA, num.fruit)) %>% 
  ggplot(aes(x=pop, y=num.fruit, colour = Pop.Type)) + #no 0s 
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
#no obvious trends of heterosis 
```

## Means 
```{r}
total_fit_2024plants_summary <- total_fit_2024plants %>% 
  mutate(num.fruit=if_else(is.na(num.fruit) | num.fruit==0, NA, num.fruit)) %>%  #remove 0s
  group_by(Pop.Type, pop, dame_pop, sire_pop, 
           dame_elev, dame_GD_Recent, dame_GD_Historic, 
           meanElev, mean_GD_Recent, mean_GD_Historic) %>% 
  summarise(n=n(), n_Fecundity=sum(!is.na(num.fruit)),
            mean_ProbFruit=mean(ProbFruit, na.rm=TRUE), stdev_ProbFruit=sd(ProbFruit, na.rm=TRUE),
            mean_Fecundity=mean(num.fruit, na.rm=TRUE), stdev_Fecundity=sd(num.fruit, na.rm=TRUE),
            mean_TotalFitness=mean(TotalFitness, na.rm=TRUE), stdev_TotalFitness=sd(TotalFitness, na.rm=TRUE)) 
total_fit_2024plants_summary
```

## Mid-Parent Values
```{r}
F1_info <- total_fit_2024plants_summary %>% filter(Pop.Type=="F1") %>% select(meanElev:mean_GD_Historic)

parent_prep_probfruit <- total_fit_2024plants_summary %>% 
  filter(Pop.Type=="Parent") %>% 
  ungroup() %>% 
  select(pop, mean_ProbFruit:stdev_TotalFitness) %>% 
  pivot_wider(names_from = pop, 
              values_from = c(mean_ProbFruit, stdev_ProbFruit,
                              mean_Fecundity, stdev_Fecundity,
                              mean_TotalFitness, stdev_TotalFitness)) %>% 
  mutate("WV x TM2-mean_ProbFruit"=(mean_ProbFruit_WV+mean_ProbFruit_TM2)/2, 
         "LV1 x WL2-mean_ProbFruit"=(mean_ProbFruit_LV1+mean_ProbFruit_WL2)/2,
         "LV1 x TM2-mean_ProbFruit"=(mean_ProbFruit_LV1+mean_ProbFruit_TM2)/2, 
         "TM2 x WL2-mean_ProbFruit"=(mean_ProbFruit_TM2+mean_ProbFruit_WL2)/2,
         "CC x TM2-mean_ProbFruit"=(mean_ProbFruit_CC+mean_ProbFruit_TM2)/2, 
         "WV x WL2-mean_ProbFruit"=(mean_ProbFruit_WV+mean_ProbFruit_WL2)/2,
         "BH x TM2-mean_ProbFruit"=(mean_ProbFruit_BH+mean_ProbFruit_TM2)/2, 
         "WL2 x BH-mean_ProbFruit"=(mean_ProbFruit_BH+mean_ProbFruit_WL2)/2,
         "DPR x WL2-mean_ProbFruit"=(mean_ProbFruit_DPR+mean_ProbFruit_WL2)/2, 
         "BH x WL2-mean_ProbFruit"=(mean_ProbFruit_BH+mean_ProbFruit_WL2)/2,
         "SQ3 x WL2-mean_ProbFruit"=(mean_ProbFruit_SQ3+mean_ProbFruit_WL2)/2, 
         "TM2 x YO11-mean_ProbFruit"=(mean_ProbFruit_TM2+mean_ProbFruit_YO11)/2) %>% 
  mutate("WV x TM2-stdev_ProbFruit"=sqrt(stdev_ProbFruit_WV^2^2+stdev_ProbFruit_TM2^2), 
         "LV1 x WL2-stdev_ProbFruit"=sqrt(stdev_ProbFruit_LV1^2+stdev_ProbFruit_WL2^2),
         "LV1 x TM2-stdev_ProbFruit"=sqrt(stdev_ProbFruit_LV1^2+stdev_ProbFruit_TM2^2), 
         "TM2 x WL2-stdev_ProbFruit"=sqrt(stdev_ProbFruit_TM2^2+stdev_ProbFruit_WL2^2),
         "CC x TM2-stdev_ProbFruit"=sqrt(stdev_ProbFruit_CC^2+stdev_ProbFruit_TM2^2), 
         "WV x WL2-stdev_ProbFruit"=sqrt(stdev_ProbFruit_WV^2+stdev_ProbFruit_WL2^2),
         "BH x TM2-stdev_ProbFruit"=sqrt(stdev_ProbFruit_BH^2+stdev_ProbFruit_TM2^2), 
         "WL2 x BH-stdev_ProbFruit"=sqrt(stdev_ProbFruit_BH^2+stdev_ProbFruit_WL2^2),
         "DPR x WL2-stdev_ProbFruit"=sqrt(stdev_ProbFruit_DPR^2+stdev_ProbFruit_WL2^2), 
         "BH x WL2-stdev_ProbFruit"=sqrt(stdev_ProbFruit_BH^2+stdev_ProbFruit_WL2^2),
         "SQ3 x WL2-stdev_ProbFruit"=sqrt(stdev_ProbFruit_SQ3^2+stdev_ProbFruit_WL2^2), 
         "TM2 x YO11-stdev_ProbFruit"=sqrt(stdev_ProbFruit_TM2^2+stdev_ProbFruit_YO11^2)) %>% 
  mutate("WV x TM2-mean_Fecundity"=(mean_Fecundity_WV+mean_Fecundity_TM2)/2, 
         "LV1 x WL2-mean_Fecundity"=(mean_Fecundity_LV1+mean_Fecundity_WL2)/2,
         "LV1 x TM2-mean_Fecundity"=(mean_Fecundity_LV1+mean_Fecundity_TM2)/2, 
         "TM2 x WL2-mean_Fecundity"=(mean_Fecundity_TM2+mean_Fecundity_WL2)/2,
         "CC x TM2-mean_Fecundity"=(mean_Fecundity_CC+mean_Fecundity_TM2)/2, 
         "WV x WL2-mean_Fecundity"=(mean_Fecundity_WV+mean_Fecundity_WL2)/2,
         "BH x TM2-mean_Fecundity"=(mean_Fecundity_BH+mean_Fecundity_TM2)/2, 
         "WL2 x BH-mean_Fecundity"=(mean_Fecundity_BH+mean_Fecundity_WL2)/2,
         "DPR x WL2-mean_Fecundity"=(mean_Fecundity_DPR+mean_Fecundity_WL2)/2, 
         "BH x WL2-mean_Fecundity"=(mean_Fecundity_BH+mean_Fecundity_WL2)/2,
         "SQ3 x WL2-mean_Fecundity"=(mean_Fecundity_SQ3+mean_Fecundity_WL2)/2, 
         "TM2 x YO11-mean_Fecundity"=(mean_Fecundity_TM2+mean_Fecundity_YO11)/2) %>% 
  mutate("WV x TM2-stdev_Fecundity"=sqrt(stdev_Fecundity_WV^2^2+stdev_Fecundity_TM2^2), 
         "LV1 x WL2-stdev_Fecundity"=sqrt(stdev_Fecundity_LV1^2+stdev_Fecundity_WL2^2),
         "LV1 x TM2-stdev_Fecundity"=sqrt(stdev_Fecundity_LV1^2+stdev_Fecundity_TM2^2), 
         "TM2 x WL2-stdev_Fecundity"=sqrt(stdev_Fecundity_TM2^2+stdev_Fecundity_WL2^2),
         "CC x TM2-stdev_Fecundity"=sqrt(stdev_Fecundity_CC^2+stdev_Fecundity_TM2^2), 
         "WV x WL2-stdev_Fecundity"=sqrt(stdev_Fecundity_WV^2+stdev_Fecundity_WL2^2),
         "BH x TM2-stdev_Fecundity"=sqrt(stdev_Fecundity_BH^2+stdev_Fecundity_TM2^2), 
         "WL2 x BH-stdev_Fecundity"=sqrt(stdev_Fecundity_BH^2+stdev_Fecundity_WL2^2),
         "DPR x WL2-stdev_Fecundity"=sqrt(stdev_Fecundity_DPR^2+stdev_Fecundity_WL2^2), 
         "BH x WL2-stdev_Fecundity"=sqrt(stdev_Fecundity_BH^2+stdev_Fecundity_WL2^2),
         "SQ3 x WL2-stdev_Fecundity"=sqrt(stdev_Fecundity_SQ3^2+stdev_Fecundity_WL2^2), 
         "TM2 x YO11-stdev_Fecundity"=sqrt(stdev_Fecundity_TM2^2+stdev_Fecundity_YO11^2)) %>% 
  mutate("WV x TM2-mean_TotalFitness"=(mean_TotalFitness_WV+mean_TotalFitness_TM2)/2, 
         "LV1 x WL2-mean_TotalFitness"=(mean_TotalFitness_LV1+mean_TotalFitness_WL2)/2,
         "LV1 x TM2-mean_TotalFitness"=(mean_TotalFitness_LV1+mean_TotalFitness_TM2)/2, 
         "TM2 x WL2-mean_TotalFitness"=(mean_TotalFitness_TM2+mean_TotalFitness_WL2)/2,
         "CC x TM2-mean_TotalFitness"=(mean_TotalFitness_CC+mean_TotalFitness_TM2)/2, 
         "WV x WL2-mean_TotalFitness"=(mean_TotalFitness_WV+mean_TotalFitness_WL2)/2,
         "BH x TM2-mean_TotalFitness"=(mean_TotalFitness_BH+mean_TotalFitness_TM2)/2, 
         "WL2 x BH-mean_TotalFitness"=(mean_TotalFitness_BH+mean_TotalFitness_WL2)/2,
         "DPR x WL2-mean_TotalFitness"=(mean_TotalFitness_DPR+mean_TotalFitness_WL2)/2, 
         "BH x WL2-mean_TotalFitness"=(mean_TotalFitness_BH+mean_TotalFitness_WL2)/2,
         "SQ3 x WL2-mean_TotalFitness"=(mean_TotalFitness_SQ3+mean_TotalFitness_WL2)/2, 
         "TM2 x YO11-mean_TotalFitness"=(mean_TotalFitness_TM2+mean_TotalFitness_YO11)/2) %>% 
  mutate("WV x TM2-stdev_TotalFitness"=sqrt(stdev_TotalFitness_WV^2^2+stdev_TotalFitness_TM2^2), 
         "LV1 x WL2-stdev_TotalFitness"=sqrt(stdev_TotalFitness_LV1^2+stdev_TotalFitness_WL2^2),
         "LV1 x TM2-stdev_TotalFitness"=sqrt(stdev_TotalFitness_LV1^2+stdev_TotalFitness_TM2^2), 
         "TM2 x WL2-stdev_TotalFitness"=sqrt(stdev_TotalFitness_TM2^2+stdev_TotalFitness_WL2^2),
         "CC x TM2-stdev_TotalFitness"=sqrt(stdev_TotalFitness_CC^2+stdev_TotalFitness_TM2^2), 
         "WV x WL2-stdev_TotalFitness"=sqrt(stdev_TotalFitness_WV^2+stdev_TotalFitness_WL2^2),
         "BH x TM2-stdev_TotalFitness"=sqrt(stdev_TotalFitness_BH^2+stdev_TotalFitness_TM2^2), 
         "WL2 x BH-stdev_TotalFitness"=sqrt(stdev_TotalFitness_BH^2+stdev_TotalFitness_WL2^2),
         "DPR x WL2-stdev_TotalFitness"=sqrt(stdev_TotalFitness_DPR^2+stdev_TotalFitness_WL2^2), 
         "BH x WL2-stdev_TotalFitness"=sqrt(stdev_TotalFitness_BH^2+stdev_TotalFitness_WL2^2),
         "SQ3 x WL2-stdev_TotalFitness"=sqrt(stdev_TotalFitness_SQ3^2+stdev_TotalFitness_WL2^2), 
         "TM2 x YO11-stdev_TotalFitness"=sqrt(stdev_TotalFitness_TM2^2+stdev_TotalFitness_YO11^2)) %>% 
  select(`WV x TM2-mean_ProbFruit`:`TM2 x YO11-stdev_TotalFitness`) %>% 
  pivot_longer(cols = everything(), names_to = c("pop", "measurement"), names_sep = "-", values_to = "value") %>%
  pivot_wider(names_from = measurement, values_from = value) %>% 
  left_join(F1_info) %>% 
  mutate(pop = paste0(pop, "_midParent"), Pop.Type="midParent")

mid_parent_F1s_fitness <- total_fit_2024plants_summary %>% 
   filter(Pop.Type=="F1") %>% 
  bind_rows(parent_prep_probfruit) %>% 
  mutate(elevation.group=if_else(meanElev<1000, "All Low",
                                 if_else(meanElev>2000, "All High", "Mixed")))
mid_parent_F1s_fitness
```

## Figures 
```{r}
mid_parent_F1s_fitness %>% 
  ggplot(aes(x=pop, y=mean_ProbFruit, fill=meanElev, colour=meanElev)) +
  geom_errorbar(aes(ymin=mean_ProbFruit-0.01,ymax=mean_ProbFruit+stdev_ProbFruit),width=.2, position = 
                  position_dodge(0.75)) +
  geom_col(width = 0.7,position = position_dodge(0.75)) + 
  theme_classic() + 
  scale_y_continuous(expand = c(0.01, 0), limits=c(0,1)) +
  scale_fill_gradient(low = "#F5A540", high = "#0043F0") +
  scale_colour_gradient(low = "#F5A540", high = "#0043F0") +
  theme(text=element_text(size=25),axis.text.x = element_text(angle = 45, hjust = 1)) + 
  labs(y="Avg Probability of Fruits + Stdev", x="Population", fill="Avg Elevation (m)", color="Avg Elevation (m)") + 
  facet_wrap(vars(elevation.group), scales="free")
ggsave("../output/WL2_Traits/WL2_2024Plants_ProbFruit.png", width = 20, height = 8, units = "in")

mid_parent_F1s_fitness %>% 
  ggplot(aes(x=pop, y=mean_Fecundity, fill=meanElev, colour=meanElev)) +
  geom_errorbar(aes(ymin=mean_Fecundity-0.01,ymax=mean_Fecundity+stdev_Fecundity),width=.2, position = 
                  position_dodge(0.75)) +
  geom_col(width = 0.7,position = position_dodge(0.75)) + 
  theme_classic() + 
  scale_y_continuous(expand = c(0.01, 0)) +
  scale_fill_gradient(low = "#F5A540", high = "#0043F0") +
  scale_colour_gradient(low = "#F5A540", high = "#0043F0") +
  theme(text=element_text(size=25),axis.text.x = element_text(angle = 45, hjust = 1)) + 
  labs(y="Avg Fecundity + Stdev", x="Population", fill="Avg Elevation (m)", color="Avg Elevation (m)")  + 
  facet_wrap(vars(elevation.group), scales="free")
ggsave("../output/WL2_Traits/WL2_2024Plants_Fecundity.png", width = 20, height = 8, units = "in")

mid_parent_F1s_fitness %>% 
  ggplot(aes(x=pop, y=mean_TotalFitness, fill=meanElev, colour=meanElev)) +
  geom_errorbar(aes(ymin=mean_TotalFitness-0.01,ymax=mean_TotalFitness+stdev_TotalFitness),width=.2, position = 
                  position_dodge(0.75)) +
  geom_col(width = 0.7,position = position_dodge(0.75)) + 
  theme_classic() + 
  scale_y_continuous(expand = c(0.01, 0)) +
  scale_fill_gradient(low = "#F5A540", high = "#0043F0") +
  scale_colour_gradient(low = "#F5A540", high = "#0043F0") +
  theme(text=element_text(size=25),axis.text.x = element_text(angle = 45, hjust = 1)) + 
  labs(y="Avg Total Fitness + Stdev", x="Population", fill="Avg Elevation (m)", color="Avg Elevation (m)")  + 
  facet_wrap(vars(elevation.group), scales="free")
ggsave("../output/WL2_Traits/WL2_2024Plants_TotalFitness.png", width = 20, height = 8, units = "in")
```

```{r}
mid_parent_F1s_fitness %>% 
  filter(elevation.group=="All High") %>% 
  ggplot(aes(x=pop, y=mean_TotalFitness)) +
  geom_errorbar(aes(ymin=mean_TotalFitness-0.01,ymax=mean_TotalFitness+stdev_TotalFitness),width=.2, position = 
                  position_dodge(0.75)) +
  geom_col(width = 0.7,position = position_dodge(0.75), fill="#0043F0", colour="#0043F0") + 
  theme_classic() + 
  scale_y_continuous(expand = c(0.01, 0)) +
  theme(text=element_text(size=25),axis.text.x = element_text(angle = 45, hjust = 1)) + 
  labs(y="Avg Total Fitness + Stdev", x="Population", fill="Avg Elevation (m)", color="Avg Elevation (m)")  + 
  facet_wrap(vars(elevation.group), scales="free")
ggsave("../output/WL2_Traits/WL2_2024Plants_TotalFitness_AllHigh.png", width = 8, height = 8, units = "in")

mid_parent_F1s_fitness %>% 
  filter(elevation.group=="All Low") %>% 
  ggplot(aes(x=pop, y=mean_TotalFitness)) +
  geom_errorbar(aes(ymin=mean_TotalFitness-0.01,ymax=mean_TotalFitness+stdev_TotalFitness),width=.2, position = 
                  position_dodge(0.75)) +
  geom_col(width = 0.7,position = position_dodge(0.75), fill="#F5A540", colour="#F5A540") + 
  theme_classic() + 
  scale_y_continuous(expand = c(0.01, 0)) +
  theme(text=element_text(size=25),axis.text.x = element_text(angle = 45, hjust = 1)) + 
  labs(y="Avg Total Fitness + Stdev", x="Population", fill="Avg Elevation (m)", color="Avg Elevation (m)")  + 
  facet_wrap(vars(elevation.group), scales="free")
ggsave("../output/WL2_Traits/WL2_2024Plants_TotalFitness_AllLow.png", width = 8, height = 8, units = "in")

mid_parent_F1s_fitness %>% 
  filter(elevation.group=="Mixed") %>% 
  ggplot(aes(x=pop, y=mean_TotalFitness, fill=meanElev, colour=meanElev)) +
  geom_errorbar(aes(ymin=mean_TotalFitness-0.01,ymax=mean_TotalFitness+stdev_TotalFitness),width=.2, position = 
                  position_dodge(0.75)) +
  geom_col(width = 0.7,position = position_dodge(0.75)) + 
  theme_classic() + 
  scale_y_continuous(expand = c(0.01, 0)) +
  scale_fill_gradient(low = "#b46ca4", high = "#9e60b8") +
  scale_colour_gradient(low = "#b46ca4", high = "#9e60b8") +
  theme(text=element_text(size=25),axis.text.x = element_text(angle = 45, hjust = 1)) + 
  labs(y="Avg Total Fitness + Stdev", x="Population", fill="Avg Elevation (m)", color="Avg Elevation (m)")  + 
  facet_wrap(vars(elevation.group), scales="free")
ggsave("../output/WL2_Traits/WL2_2024Plants_TotalFitness_Mixed.png", width = 14, height = 8, units = "in")
```

